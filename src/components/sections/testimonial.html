<!-- 
  Section Témoignages
  Un composant réutilisable pour afficher les témoignages des clients.
  
  Fonctionnalités:
  - Carousel responsive affichant 2 cartes sur desktop, 1 sur mobile
  - Navigation par boutons et indicateurs
  - Animation de fade-in au scroll
  - Affichage d'étoiles pour la notation
  - Support d'accessibilité pour les utilisateurs préférant moins d'animations
-->

<div class="testimonials-section" 
     x-data="testimonialsComponent()" 
     x-init="init()">
  
  <!-- En-tête de section avec animations -->
  <div class="section-header" x-ref="sectionHeader">
    <h2 class="section-title" x-ref="sectionTitle">Ce que disent nos clients</h2>
    <p class="section-subtitle" x-ref="sectionSubtitle">Découvrez les expériences partagées par notre communauté de clients satisfaits</p>
  </div>
  
  <!-- Carousel de témoignages -->
  <div class="testimonials-carousel-container">
    <div class="testimonials-carousel" x-ref="carousel">
      <div class="testimonials-track" 
           x-ref="track" 
           :style="`transform: translateX(-${currentSlide * 100}%)`">
        <!-- Groupe de témoignages (2 par slide sur desktop) -->
        <template x-for="(group, groupIndex) in testimonialGroups" :key="groupIndex">
          <div class="testimonial-slide">
            <template x-for="(testimonial, index) in group" :key="testimonial.name">
              <div class="testimonial-card" x-ref="testimonialCards">
                <!-- Avatar et informations de l'utilisateur -->
                <div class="testimonial-user">
                  <div class="user-avatar">
                    <img :src="testimonial.avatar" :alt="`Photo de ${testimonial.name}`" class="avatar-image">
                  </div>
                  <div class="user-info">
                    <h3 class="user-name" x-text="testimonial.name"></h3>
                    <p class="user-position" x-text="testimonial.position"></p>
                  </div>
                </div>
                
                <!-- Contenu du témoignage -->
                <div class="testimonial-content">
                  <p class="testimonial-quote" x-text="testimonial.quote"></p>
                </div>
                
                <!-- Évaluation par étoiles -->
                <div class="testimonial-rating" :aria-label="`Note: ${testimonial.rating} sur 5`">
                  <template x-for="i in 5" :key="i">
                    <span 
                      class="star" 
                      :class="i <= testimonial.rating ? 'star-filled' : 'star-empty'"
                      aria-hidden="true">
                      ★
                    </span>
                  </template>
                </div>
              </div>
            </template>
          </div>
        </template>
      </div>
    </div>
    
    <!-- Contrôles du carousel -->
    <div class="testimonials-controls">
      <button class="carousel-control prev-btn" 
              aria-label="Témoignage précédent" 
              :disabled="currentSlide === 0"
              @click="prevSlide()">
        <svg class="control-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      
      <!-- Indicateurs -->
      <div class="carousel-indicators">
        <template x-for="(_, index) in testimonialGroups" :key="index">
          <button class="carousel-indicator" 
                  :class="{ 'active': currentSlide === index }"
                  @click="goToSlide(index)"
                  :aria-label="`Aller au témoignage ${index + 1}`"
                  :aria-current="currentSlide === index ? 'true' : 'false'"></button>
        </template>
      </div>
      
      <button class="carousel-control next-btn" 
              aria-label="Témoignage suivant" 
              :disabled="currentSlide === testimonialGroups.length - 1"
              @click="nextSlide()">
        <svg class="control-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  function testimonialsComponent() {
    return {
      testimonials: [
        {
          name: "Emma Laurent",
          position: "Directrice Marketing",
          avatar: "/assets/images/testimonials/avatar-1.jpg",
          quote: "Ce service a complètement transformé notre approche marketing. Les résultats sont impressionnants et l'équipe est vraiment à l'écoute de nos besoins.",
          rating: 5
        },
        {
          name: "Thomas Dubois",
          position: "Entrepreneur",
          avatar: "/assets/images/testimonials/avatar-2.jpg",
          quote: "En tant que startup, nous avions besoin d'une solution flexible et efficace. C'est exactement ce que nous avons trouvé ici. Je recommande vivement !",
          rating: 4
        },
        {
          name: "Sophie Martin",
          position: "Responsable Projet",
          avatar: "/assets/images/testimonials/avatar-3.jpg",
          quote: "La qualité du service client est exceptionnelle. Chaque question trouve rapidement une réponse pertinente, ce qui nous fait gagner un temps précieux.",
          rating: 5
        },
        {
          name: "Jean Moreau",
          position: "Consultant",
          avatar: "/assets/images/testimonials/avatar-4.jpg",
          quote: "J'utilise ce service depuis plus d'un an maintenant et je suis toujours aussi satisfait. Les nouvelles fonctionnalités sont pertinentes et bien pensées.",
          rating: 5
        }
      ],
      currentSlide: 0,
      
      // Propriété calculée pour regrouper les témoignages par 2 pour le desktop
      get testimonialGroups() {
        const groups = [];
        // Grouper par 2 les témoignages
        for (let i = 0; i < this.testimonials.length; i += 2) {
          groups.push(this.testimonials.slice(i, i + 2));
        }
        return groups;
      },
      
      init() {
        // Initialiser les animations quand le composant est monté
        this.animateHeader();
        this.animateCards();
        
        // Configurer l'observateur pour les animations au scroll
        this.setupScrollObserver();
        
        // Configurer la gestion responsive
        this.setupResizeListener();
        
        // Configurer l'autoplay
        this.setupAutoplay();
      },
      
      nextSlide() {
        if (this.currentSlide < this.testimonialGroups.length - 1) {
          this.currentSlide++;
        }
      },
      
      prevSlide() {
        if (this.currentSlide > 0) {
          this.currentSlide--;
        }
      },
      
      goToSlide(index) {
        this.currentSlide = index;
      },
      
      setupAutoplay() {
        // Autoplay toutes les 5 secondes
        this.autoplayInterval = setInterval(() => {
          if (this.currentSlide < this.testimonialGroups.length - 1) {
            this.currentSlide++;
          } else {
            this.currentSlide = 0;
          }
        }, 5000);
        
        // Arrêter l'autoplay quand l'utilisateur interagit avec le carousel
        const carousel = this.$refs.carousel;
        if (carousel) {
          carousel.addEventListener('mouseenter', () => {
            clearInterval(this.autoplayInterval);
          });
          
          carousel.addEventListener('mouseleave', () => {
            this.setupAutoplay();
          });
        }
      },
      
      setupResizeListener() {
        // Vérifier si nous devons ajuster le layout selon la taille d'écran
        window.addEventListener('resize', () => {
          // Réinitialiser à la première slide lors du redimensionnement
          this.currentSlide = 0;
        });
      },
      
      animateHeader() {
        // Animer le titre et le sous-titre avec un délai
        if (this.$refs.sectionTitle) {
          window.animations.fadeInUp(this.$refs.sectionTitle, {
            duration: 600,
            easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
          });
        }
        
        if (this.$refs.sectionSubtitle) {
          window.animations.fadeInUp(this.$refs.sectionSubtitle, {
            duration: 600,
            delay: 200,
            easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
          });
        }
      },
      
      animateCards() {
        // Animer chaque carte de témoignage avec un délai progressif
        if (!this.$refs.testimonialCards) return;
        
        const cards = Array.isArray(this.$refs.testimonialCards) 
          ? this.$refs.testimonialCards 
          : [this.$refs.testimonialCards];
        
        cards.forEach((card, index) => {
          window.animations.scaleIn(card, {
            duration: 500,
            delay: 300 + (index * 150),
            easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
          });
        });
      },
      
      setupScrollObserver() {
        // Observer qui déclenche l'animation quand les éléments entrent dans le viewport
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              // Si c'est l'en-tête de la section
              if (entry.target === this.$refs.sectionHeader) {
                this.animateHeader();
              }
              
              // Si c'est une carte de témoignage
              if (this.$refs.testimonialCards && 
                  Array.isArray(this.$refs.testimonialCards) && 
                  this.$refs.testimonialCards.includes(entry.target)) {
                const index = this.$refs.testimonialCards.indexOf(entry.target);
                window.animations.scaleIn(entry.target, {
                  duration: 500,
                  delay: 150 * index,
                  easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
                });
              }
              
              // Arrêter d'observer l'élément une fois animé
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });
        
        // Observer l'en-tête
        if (this.$refs.sectionHeader) {
          observer.observe(this.$refs.sectionHeader);
        }
        
        // Observer chaque carte de témoignage
        if (this.$refs.testimonialCards) {
          const cards = Array.isArray(this.$refs.testimonialCards) 
            ? this.$refs.testimonialCards 
            : [this.$refs.testimonialCards];
          
          cards.forEach(card => {
            observer.observe(card);
          });
        }
      }
    };
  }
</script>

<style>
  /* Styles pour le carousel de témoignages */
  .testimonials-section {
    @apply max-w-7xl mx-auto px-4 py-16;
  }
  
  .section-header {
    @apply text-center mb-12;
  }
  
  .section-title {
    @apply text-3xl md:text-4xl font-bold mb-3 text-[#000];
  }
  
  .section-subtitle {
    @apply text-lg text-[#1848A0] max-w-2xl mx-auto;
  }
  
  .testimonials-carousel-container {
    @apply relative max-w-6xl mx-auto;
  }
  
  .testimonials-carousel {
    @apply overflow-hidden rounded-xl;
  }
  
  .testimonials-track {
    @apply flex transition-transform duration-500 ease-out;
  }
  
  .testimonial-slide {
    @apply flex flex-col md:flex-row w-full flex-shrink-0 gap-6 p-2;
  }
  
  .testimonial-card {
    @apply flex-1 bg-white shadow-md rounded-xl p-6 border border-gray-100 flex flex-col gap-4 transform transition-all duration-300;
  }
  
  .testimonial-card:hover {
    @apply shadow-lg border-[#FFD700];
  }
  
  .testimonial-user {
    @apply flex items-center gap-4 mb-2;
  }
  
  .user-avatar {
    @apply w-14 h-14 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 border-2 border-[#FFD700];
  }
  
  .avatar-image {
    @apply w-full h-full object-cover;
  }
  
  .user-info {
    @apply flex flex-col;
  }
  
  .user-name {
    @apply font-bold text-lg text-[#000];
  }
  
  .user-position {
    @apply text-sm text-[#1848A0];
  }
  
  .testimonial-content {
    @apply flex-grow;
  }
  
  .testimonial-quote {
    @apply text-gray-700 italic leading-relaxed;
  }
  
  .testimonial-rating {
    @apply flex gap-1 mt-4;
  }
  
  .star {
    @apply text-lg;
  }
  
  .star-filled {
    @apply text-[#FFD700];
  }
  
  .star-empty {
    @apply text-gray-300;
  }
  
  /* Contrôles du carousel */
  .testimonials-controls {
    @apply flex items-center justify-center mt-8 gap-4;
  }
  
  .carousel-control {
    @apply w-10 h-10 rounded-full bg-white shadow flex items-center justify-center text-[#1848A0] hover:bg-[#1848A0] hover:text-white transition-colors duration-300 disabled:opacity-30 disabled:pointer-events-none;
  }
  
  .control-icon {
    @apply w-5 h-5;
  }
  
  .carousel-indicators {
    @apply flex gap-2;
  }
  
  .carousel-indicator {
    @apply w-3 h-3 rounded-full bg-gray-300 transition-all duration-300;
  }
  
  .carousel-indicator.active {
    @apply bg-[#FFD700] w-6;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .testimonial-slide {
      @apply flex-col;
    }
  }
</style> 